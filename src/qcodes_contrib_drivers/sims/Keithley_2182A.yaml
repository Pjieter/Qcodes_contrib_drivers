spec: "1.1"
devices:
  Keithley2182A:
    error:
      status_register:
        - q: "*STB?"
          command_error: 32
          query_error: 4
    eom:
      GPIB INSTR:
        q: "\n"
        r: "\n"
      ASRL INSTR:
        q: "\n" 
        r: "\n"
      USB INSTR:
        q: "\n"
        r: "\n"
      TCPIP INSTR:
        q: "\n"
        r: "\n"
    
    properties:
      # Measurement function mode
      function:
        default: '"VOLT:DC"'
        getter:
          q: "SENS:FUNC?"
          r: "{}"
        setter:
          q: "SENS:FUNC {}"
        specs:
          type: str
      
      # Voltage range
      range:
        default: 1.0
        getter:
          q: "SENS:RANG?"
          r: "{:e}"
        setter:
          q: "SENS:RANG {}"
        specs:
          type: float
      
      # Auto range setting - use ON/OFF strings
      auto_range:
        default: "ON"
        getter:
          q: "SENS:RANG:AUTO?"
          r: "{}"
        setter:
          q: "SENS:RANG:AUTO {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # NPLC (Number of Power Line Cycles)
      nplc:
        default: 1.0
        getter:
          q: "SENS:NPLC?"
          r: "{:e}"
        setter:
          q: "SENS:NPLC {}"
        specs:
          type: float
      
      # Aperture time
      aperture:
        default: 0.016667
        getter:
          q: "SENS:APER?"
          r: "{:e}"
        setter:
          q: "SENS:APER {}"
        specs:
          type: float
      
      # Line frequency
      line_freq:
        default: 60
        getter:
          q: "SYST:LFR?"
          r: "{}"
        setter:
          q: "SYST:LFR {}"
        specs:
          type: int
          valid: [50, 60]
      
      # Averaging enabled - use ON/OFF strings
      averaging_enabled:
        default: "OFF"
        getter:
          q: "SENS:AVER?"
          r: "{}"
        setter:
          q: "SENS:AVER {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Averaging count
      averaging_count:
        default: 10
        getter:
          q: "SENS:AVER:COUN?"
          r: "{}"
        setter:
          q: "SENS:AVER:COUN {}"
        specs:
          type: int
      
      # Trigger source
      trigger_source:
        default: "IMM"
        getter:
          q: "TRIG:SOUR?"
          r: "{}"
        setter:
          q: "TRIG:SOUR {}"
        specs:
          type: str
      
      # Trigger delay
      trigger_delay:
        default: 0.0
        getter:
          q: "TRIG:DEL?"
          r: "{:e}"
        setter:
          q: "TRIG:DEL {}"
        specs:
          type: float
      
      # Temperature units
      temp_units:
        default: "K"
        getter:
          q: "UNIT:TEMP?"
          r: "{}"
        setter:
          q: "UNIT:TEMP {}"
        specs:
          type: str
      
      # Display enabled - use ON/OFF strings
      display_enabled:
        default: "ON"
        getter:
          q: "DISP:ENAB?"
          r: "{}"
        setter:
          q: "DISP:ENAB {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Input impedance auto - use ON/OFF strings
      input_impedance:
        default: "ON"
        getter:
          q: "SENS:VOLT:DC:IMP:AUTO?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:IMP:AUTO {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Analog filter - use ON/OFF strings
      analog_filter:
        default: "OFF"
        getter:
          q: "SENS:VOLT:DC:LPAS?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:LPAS {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Digital filter - use ON/OFF strings
      digital_filter:
        default: "OFF"
        getter:
          q: "SENS:VOLT:DC:DFIL?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:DFIL {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Auto-zero - use ON/OFF strings
      auto_zero:
        default: "ON"
        getter:
          q: "SENS:VOLT:DC:AZER?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:AZER {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
    
    dialogues:
      # IDN query
      - q: "*IDN?"
        r: "KEITHLEY INSTRUMENTS INC.,MODEL 2182A,1234567,C01 Mar 31 2022 14:29:42"

      # Reset and clear commands
      - q: "*RST"
        r: ""
      - q: "*CLS"
        r: ""
      - q: "*TST?"
        r: "0"

      # Core measurement commands - always return consistent values
      - q: "MEAS:VOLT:DC?"
        r: "1.234567E-06"
      - q: "MEAS:TEMP?"
        r: "2.981500E+02"
      - q: "FETC?"
        r: "1.234567E-06"
      - q: "READ?"
        r: "1.234567E-06"

      # Handle ON/OFF variations for boolean parameters
      - q: "SENS:RANG:AUTO ON"
        r: ""
      - q: "SENS:RANG:AUTO OFF"
        r: ""
      - q: "SENS:AVER ON"
        r: ""
      - q: "SENS:AVER OFF"
        r: ""
      - q: "DISP:ENAB ON"
        r: ""
      - q: "DISP:ENAB OFF"
        r: ""
      - q: "SENS:VOLT:DC:IMP:AUTO ON"
        r: ""
      - q: "SENS:VOLT:DC:IMP:AUTO OFF"
        r: ""
      - q: "SENS:VOLT:DC:LPAS ON"
        r: ""
      - q: "SENS:VOLT:DC:LPAS OFF"
        r: ""
      - q: "SENS:VOLT:DC:DFIL ON"
        r: ""
      - q: "SENS:VOLT:DC:DFIL OFF"
        r: ""
      - q: "SENS:VOLT:DC:AZER ON"
        r: ""
      - q: "SENS:VOLT:DC:AZER OFF"
        r: ""

      # Trigger commands
      - q: "INIT"
        r: ""
      - q: "ABOR"
        r: ""
      - q: "*TRG"
        r: ""

      # Error query
      - q: "SYST:ERR?"
        r: "0,\"No error\""

resources:
  GPIB::1::INSTR:
    device: Keithley2182A